<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alta Cal Profit Share Calculator</title>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media print { .no-print { display: none !important; } }
    input { -webkit-appearance: none; appearance: none; }
    input:focus { outline: 2px solid #3b82f6; }
    @media (max-width: 768px) {
      .grid-cols-12 { display: block !important; }
      .grid-cols-12 > div { width: 100% !important; border-right: none !important; border-bottom: 1px solid #000; }
      .grid-cols-12 > div:last-child { border-bottom: none; }
      .mobile-stack { grid-template-columns: 1fr !important; }
      .mobile-full { width: 100% !important; }
    }
  </style>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    const { useState, useRef } = React;

    /* ICONS */
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );
    const Printer = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    /* HELPERS */
    const fmt = (v) => "$" + (Number(v || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ","));
    const parseNum = (v) => parseFloat((v || "").toString().replace(/[,$]/g, "")) || 0;
    const defaultHousePct = (amt) => amt <= 20000 ? 10 : amt < 30000 ? 9 : 8;

    /* SINGLE CALCULATOR COMPONENT */
    function SingleCalculator({ data, onChange, onRemove, canRemove, onPrint }) {
      const contract = parseNum(data.contractAmount);
      const housePct = parseNum(data.houseFeePercent);
      const houseFee = (contract * housePct) / 100;
      const afterHouse = contract - houseFee;
      const dealerFeeAmt = (parseNum(data.financeAmount) * parseNum(data.dealerFee)) / 100;
      const totalAfterFees = afterHouse - parseNum(data.laborMaterial) - dealerFeeAmt;

      const profitPct = afterHouse > 0 ? (totalAfterFees / afterHouse) * 100 : 0;
      let vetRate = 25, repRate = 20;
      if (profitPct >= 50) { vetRate = 55; repRate = 40; }
      else if (profitPct >= 40) { vetRate = 45; repRate = 30; }
      else if (profitPct >= 33) { vetRate = 35; repRate = 25; }

      const vets = parseNum(data.numVets);
      const reps = parseNum(data.numReps);
      const totalPeople = vets + reps;
      const vetTotal = (totalAfterFees * vetRate) / 100;
      const repTotal = (totalAfterFees * repRate) / 100;
      const perVet = totalPeople > 0 ? vetTotal / totalPeople : 0;
      const perRep = totalPeople > 0 ? repTotal / totalPeople : 0;
      const rideFee = parseNum(data.rideAlong);
      const rideBonus = parseNum(data.rideAlongBonus);
      const rideTotal = rideFee + rideBonus;
      const rideCount = parseNum(data.numRideAlongs);
      const perRide = rideCount > 0 ? rideTotal / rideCount : 0;

      const onAmtChange = (f) => (e) => {
        const raw = e.target.value.replace(/[^0-9.]/g, "");
        let n = { ...data, [f]: raw };
        if (f === "contractAmount" && !data.houseFeeManual)
          n.houseFeePercent = defaultHousePct(parseNum(raw));
        onChange(n);
      };

      return (
        <div className="relative mb-6 bg-white border-4 border-gray-300 rounded-lg p-3">
          {canRemove && (
            <button onClick={onRemove}
              className="absolute -top-3 -right-3 bg-red-600 text-white rounded-full p-2"><X size={20}/></button>
          )}
          <button onClick={onPrint}
            className="absolute -top-3 -left-3 bg-green-600 text-white rounded-full p-2"><Printer size={20}/></button>

          <div className="flex justify-between mb-2">
            <input type="text" placeholder="Customer Name"
              value={data.customerName}
              onChange={(e)=>onChange({...data,customerName:e.target.value})}
              className="border p-1 flex-1 mr-2"/>
            <input type="text" placeholder="Job #"
              value={data.jobNumber}
              onChange={(e)=>onChange({...data,jobNumber:e.target.value})}
              className="border p-1 w-32"/>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-5 gap-2 text-sm">
            <input type="number" inputMode="decimal" placeholder="Contract"
              value={data.contractAmount} onChange={onAmtChange("contractAmount")}
              className="border p-1 text-right"/>
            <input type="number" inputMode="decimal" placeholder="Finance"
              value={data.financeAmount} onChange={onAmtChange("financeAmount")}
              className="border p-1 text-right"/>
            <input type="number" inputMode="decimal" placeholder="Dealer Fee %"
              value={data.dealerFee}
              onChange={(e)=>onChange({...data,dealerFee:e.target.value.replace(/[^0-9.]/g,"")})}
              className="border p-1 text-right"/>
            <input type="number" inputMode="decimal" placeholder="Labor/Mat"
              value={data.laborMaterial} onChange={onAmtChange("laborMaterial")}
              className="border p-1 text-right"/>
            <input type="number" inputMode="decimal" placeholder="House %"
              value={data.houseFeePercent}
              onChange={(e)=>onChange({...data,houseFeePercent:e.target.value.replace(/[^0-9.]/g,""),houseFeeManual:true})}
              className="border p-1 text-right"/>
          </div>

          <div className="mt-2 text-xs text-gray-700">
            After Fees: <strong>{fmt(totalAfterFees)}</strong> | Profit Margin: {profitPct.toFixed(1)}%
          </div>

          <div className="mt-2 grid grid-cols-3 gap-2 text-sm">
            <input type="number" inputMode="decimal" placeholder="Ride Fee"
              value={data.rideAlong} onChange={onAmtChange("rideAlong")}
              className="border p-1 text-right"/>
            <input type="number" inputMode="decimal" placeholder="Ride Bonus"
              value={data.rideAlongBonus} onChange={onAmtChange("rideAlongBonus")}
              className="border p-1 text-right"/>
            <input type="number" inputMode="numeric" placeholder="#Ride Alongs"
              value={data.numRideAlongs}
              onChange={(e)=>onChange({...data,numRideAlongs:e.target.value.replace(/[^0-9]/g,"")})}
              className="border p-1 text-right"/>
          </div>

          <div className="mt-3 grid grid-cols-2 gap-2 text-sm">
            <input type="number" inputMode="numeric" placeholder="#Vets"
              value={data.numVets}
              onChange={(e)=>onChange({...data,numVets:e.target.value.replace(/[^0-9]/g,"")})}
              className="border p-1 text-right"/>
            <input type="number" inputMode="numeric" placeholder="#Reps"
              value={data.numReps}
              onChange={(e)=>onChange({...data,numReps:e.target.value.replace(/[^0-9]/g,"")})}
              className="border p-1 text-right"/>
          </div>

          <div className="mt-3 grid grid-cols-3 gap-2 text-sm">
            <div className="border p-2 text-center bg-green-100 font-bold">Vet Pay: {fmt(perVet)}</div>
            <div className="border p-2 text-center bg-purple-100 font-bold">Rep Pay: {fmt(perRep)}</div>
            <div className="border p-2 text-center bg-yellow-100 font-bold">Ride Pay: {fmt(perRide)}</div>
          </div>
        </div>
      );
    }

    /* APP */
    function App() {
      const blank = () => ({
        id: Date.now(), customerName:"", jobNumber:"",
        contractAmount:"", financeAmount:"", dealerFee:"",
        laborMaterial:"", houseFeePercent:"10", houseFeeManual:false,
        rideAlong:"", rideAlongBonus:"", numRideAlongs:"",
        numVets:"", numReps:""
      });
      const [calcs, setCalcs] = useState([blank()]);

      const totals = calcs.reduce((acc, c) => {
        const contract = parseNum(c.contractAmount);
        const housePct = parseNum(c.houseFeePercent);
        const houseFee = (contract * housePct)/100;
        const afterHouse = contract - houseFee;
        const dealerFeeAmt = (parseNum(c.financeAmount)*parseNum(c.dealerFee))/100;
        const totalAfter = afterHouse - parseNum(c.laborMaterial) - dealerFeeAmt;
        const profitPct = afterHouse>0?(totalAfter/afterHouse)*100:0;
        let vetRate=25,repRate=20;
        if(profitPct>=50){vetRate=55;repRate=40;}
        else if(profitPct>=40){vetRate=45;repRate=30;}
        else if(profitPct>=33){vetRate=35;repRate=25;}
        const vets=parseNum(c.numVets),reps=parseNum(c.numReps);
        const totalPeople=vets+reps;
        const vetTotal=(totalAfter*vetRate)/100;
        const repTotal=(totalAfter*repRate)/100;
        const perVet=totalPeople>0?vetTotal/totalPeople:0;
        const perRep=totalPeople>0?repTotal/totalPeople:0;
        const rideFee=parseNum(c.rideAlong);
        const rideBonus=parseNum(c.rideAlongBonus);
        acc.vet+=perVet*vets;
        acc.rep+=perRep*reps;
        acc.rideFee+=rideFee;
        acc.rideBonus+=rideBonus;
        acc.company+= (perVet*vets)+(perRep*reps)+rideBonus;
        return acc;
      },{vet:0,rep:0,rideFee:0,rideBonus:0,company:0});

      return (
        <div className="p-4">
          <div className="bg-white rounded-lg shadow-lg p-6 mb-6 border-4 border-blue-500">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-3xl font-bold text-blue-800">ALTA CAL PROFIT SHARE</h1>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-green-600 text-white p-4 rounded-lg">
                <div className="text-sm font-bold">TOTAL VET PAYOUT</div>
                <div className="text-3xl font-bold">{fmt(totals.vet)}</div>
              </div>
              <div className="bg-purple-600 text-white p-4 rounded-lg">
                <div className="text-sm font-bold">TOTAL REP PAYOUT</div>
                <div className="text-3xl font-bold">{fmt(totals.rep)}</div>
              </div>
              <div className="bg-amber-500 text-white p-4 rounded-lg">
                <div className="text-sm font-bold">TOTAL RIDE-ALONG (FEE + BONUS)</div>
                <div className="text-3xl font-bold">{fmt(totals.rideFee+totals.rideBonus)}</div>
                <div className="text-xs">Bonus only: {fmt(totals.rideBonus)}</div>
              </div>
              <div className="bg-sky-600 text-white p-4 rounded-lg">
                <div className="text-sm font-bold">TOTAL PAYOUT (COMPANY)</div>
                <div className="text-3xl font-bold">{fmt(totals.company)}</div>
                <div className="text-xs">Vet + Rep + Ride Bonus (fee excluded)</div>
              </div>
            </div>
          </div>

          {calcs.map((c)=>(
            <SingleCalculator key={c.id} data={c}
              onChange={(n)=>setCalcs(arr=>arr.map(x=>x.id===c.id?n:x))}
              onRemove={()=>setCalcs(arr=>arr.filter(x=>x.id!==c.id))}
              canRemove={calcs.length>1}
              onPrint={()=>window.print()}
            />
          ))}

          <div className="text-center mt-6">
            <button onClick={()=>setCalcs(a=>[...a,blank()])}
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full inline-flex items-center">
              <Plus size={24}/> <span className="ml-2">ADD NEW FILE</span>
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
