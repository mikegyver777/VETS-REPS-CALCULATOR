<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Alta Cal Profit Share Calculator</title>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX on static hosting -->
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Strong, high-contrast lines & better print legibility */
    :root {
      --ink: #000000;
      --ink-2: #111111;
      --ink-3: #1f1f1f;
      --blue-ink: #0b3aa9;
      --green-ink: #065f46;
      --purple-ink: #5b21b6;
      --amber-ink: #92400e;
    }

    body { color: var(--ink); }
    .hard-border { border: 2px solid var(--ink)!important; }
    .hard-border-b { border-bottom: 2px solid var(--ink)!important; }
    .hard-border-r { border-right: 2px solid var(--ink)!important; }
    .hard-border-l { border-left: 2px solid var(--ink)!important; }
    .hard-border-t { border-top: 2px solid var(--ink)!important; }

    /* Mobile stacking */
    @media (max-width: 768px) {
      .grid-cols-12 { display:block!important; }
      .grid-cols-12 > div { width:100%!important; border-right:none!important; border-bottom:2px solid var(--ink)!important; }
      .grid-cols-12 > div:last-child { border-bottom:none!important; }
      .mobile-stack { grid-template-columns: 1fr!important; }
      .mobile-full { width: 100%!important; }
    }

    /* Print styles for crisp black lines and fitting */
    @media print {
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { color: #000; }
      .no-print { display: none !important; }
      .only-print { display: block !important; }
      .hard-border, .hard-border-b, .hard-border-r, .hard-border-l, .hard-border-t { border-color:#000!important; }
    }

    .only-print { display: none; }

    /* Page size & margins for individual prints */
    @page {
      size: letter;
      margin: 0.5in;
    }

    /* Inputs focus outline */
    input { -webkit-appearance: none; appearance: none; }
    input:focus { outline: 2px solid #1f4ae0; }
  </style>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react">
    const { useState, useRef } = React;

    /* ===== Icons (inline) ===== */
    const Plus = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    const X = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );
    const Printer = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    /* ===== Helpers ===== */
    const fmt = (v) =>
      '$' + (Number.isFinite(+v) ? (+v) : 0)
              .toFixed(2)
              .replace(/\B(?=(\d{3})+(?!\d))/g, ',');

    const parseNum = (v) => {
      const n = parseFloat(String(v ?? '').replace(/[,$]/g, ''));
      return Number.isFinite(n) ? n : 0;
    };

    const defaultHousePct = (amt) => {
      const a = +amt || 0;
      if (a <= 20000) return 10;
      if (a < 30000)  return 9;
      return 8; // >= 30000
    };

    /* ===== Single Calculator ===== */
    function SingleCalculator({ data, onChange, onRemove, canRemove, onPrint }) {
      const contractAmount   = parseNum(data.contractAmount);
      const houseFeePercent  = parseNum(data.houseFeePercent);
      const houseFeeAmount   = (contractAmount * houseFeePercent) / 100;

      const dealerFeeAmount  = (parseNum(data.financeAmount) * parseNum(data.dealerFee)) / 100;
      const creditCardFeeAmt = (parseNum(data.creditCard) * parseNum(data.creditCardFee)) / 100;

      const afterHouseFee    = contractAmount - houseFeeAmount;
      const totalAfterFees   = afterHouseFee - parseNum(data.laborMaterial) - dealerFeeAmount;
      const percentOfContract= afterHouseFee > 0 ? (totalAfterFees / afterHouseFee) * 100 : 0;

      let vetRate = 25;
      if (percentOfContract >= 50) vetRate = 55;
      else if (percentOfContract >= 40) vetRate = 45;
      else if (percentOfContract >= 33) vetRate = 35;

      let repRate = 20;
      if (percentOfContract >= 50) repRate = 40;
      else if (percentOfContract >= 40) repRate = 30;
      else if (percentOfContract >= 33) repRate = 25;

      const vetsCount        = parseNum(data.numVets);
      const repsCount        = parseNum(data.numReps);
      const totalPeople      = vetsCount + repsCount;

      const vetCommissionTot = (totalAfterFees * vetRate) / 100;
      const repCommissionTot = (totalAfterFees * repRate) / 100;

      const perVetPayout     = totalPeople > 0 ? (vetCommissionTot / totalPeople) : 0;
      const perRepPayout     = totalPeople > 0 ? (repCommissionTot / totalPeople) : 0;

      const rideAlongFeePer  = totalPeople > 0 ? parseNum(data.rideAlong) / totalPeople : 0;
      const ccFeePer         = totalPeople > 0 ? creditCardFeeAmt / totalPeople : 0;

      const finalPerVet      = perVetPayout - rideAlongFeePer - ccFeePer;
      const finalPerRep      = perRepPayout - rideAlongFeePer - ccFeePer;

      const rideAlongCount   = parseNum(data.numRideAlongs);
      const totalRideAlong   = parseNum(data.rideAlong) + parseNum(data.rideAlongBonus);
      const perRideAlong     = rideAlongCount > 0 ? totalRideAlong / rideAlongCount : 0;

      // Inputs with iPhone/iPad numeric keypad and House% auto-defaults
      const onAmtChange = (field) => (e) => {
        const raw = e.target.value.replace(/[^0-9.]/g, '');
        let next = { ...data, [field]: raw };
        if (field === 'contractAmount' && !data.houseFeeManual) {
          next.houseFeePercent = String(defaultHousePct(raw));
        }
        onChange(next);
      };
      const onHousePctChange = (e) => {
        const raw = e.target.value.replace(/[^0-9.]/g, '');
        onChange({ ...data, houseFeePercent: raw, houseFeeManual: true });
      };

      return (
        <div className="relative mb-6 bg-white rounded-lg hard-border">
          {canRemove && (
            <button
              onClick={onRemove}
              className="absolute -top-3 -right-3 bg-red-700 text-white rounded-full p-2 z-10 shadow"
              title="Remove"
            >
              <X size={18}/>
            </button>
          )}

          <button
            onClick={onPrint}
            className="absolute -top-3 -left-3 bg-green-700 text-white rounded-full p-2 z-10 shadow"
            title="Print this file"
          >
            <Printer size={18}/>
          </button>

          {/* Header */}
          <div className="py-3 px-4 hard-border-b" style="background:#c7ddff">
            <div className="grid grid-cols-3 gap-4 items-center">
              <div>
                <label className="text-xs font-bold block mb-1">CUSTOMER NAME</label>
                <input
                  type="text" autoComplete="off"
                  value={data.customerName}
                  onChange={(e)=>onChange({...data, customerName:e.target.value})}
                  className="w-full px-2 py-1 border rounded hard-border"
                />
              </div>
              <h2 className="text-lg font-extrabold text-center">PROFIT SHARE CALCULATOR</h2>
              <div>
                <label className="text-xs font-bold block mb-1">JOB NUMBER</label>
                <input
                  type="text" autoComplete="off"
                  value={data.jobNumber}
                  onChange={(e)=>onChange({...data, jobNumber:e.target.value})}
                  className="w-full px-2 py-1 border rounded hard-border"
                />
              </div>
            </div>
          </div>

          {/* Row 1 */}
          <div className="grid grid-cols-12 hard-border-b">
            <div className="col-span-1 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">CONTRACT</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.contractAmount} onChange={onAmtChange('contractAmount')}
                  className="w-full text-right border px-1 hard-border"/>
              </div>
            </div>

            <div className="col-span-1 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">CASH</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.cashCheck} onChange={onAmtChange('cashCheck')}
                  className="w-full text-right border px-1 hard-border"/>
              </div>
            </div>

            <div className="col-span-2 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">FINANCE</div>
              <div className="grid grid-cols-2 gap-1">
                <div className="flex items-center">
                  <span className="text-xs mr-1">$</span>
                  <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                    value={data.financeAmount} onChange={onAmtChange('financeAmount')}
                    className="w-full text-right border px-1 hard-border"/>
                </div>
                <div className="flex items-center">
                  <span className="text-xs mr-1">D%</span>
                  <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                    value={data.dealerFee}
                    onChange={(e)=>onChange({...data, dealerFee:e.target.value.replace(/[^0-9.]/g,'')})}
                    className="w-full text-right border px-1 hard-border"/>
                </div>
              </div>
            </div>

            <div className="col-span-2 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">CREDIT CARD</div>
              <div className="grid grid-cols-2 gap-1">
                <div className="flex items-center">
                  <span className="mr-1">$</span>
                  <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                    value={data.creditCard} onChange={onAmtChange('creditCard')}
                    className="w-full text-right border px-1 hard-border"/>
                </div>
                <div className="flex items-center">
                  <span className="text-xs mr-1">%</span>
                  <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                    value={data.creditCardFee}
                    onChange={(e)=>onChange({...data, creditCardFee:e.target.value.replace(/[^0-9.]/g,'')})}
                    className="w-full text-right border px-1 hard-border"/>
                </div>
              </div>
            </div>

            <div className="col-span-1 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">HOUSE</div>
              <div className="flex items-center mb-1">
                <span className="text-xs mr-1">%</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.houseFeePercent} onChange={onHousePctChange}
                  className="w-full text-right border px-1 hard-border"/>
              </div>
              <div className="text-xs font-extrabold text-right">{fmt(houseFeeAmount)}</div>
            </div>

            <div className="col-span-1 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">LABOR</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.laborMaterial} onChange={onAmtChange('laborMaterial')}
                  className="w-full text-right border px-1 hard-border"/>
              </div>
            </div>

            <div className="col-span-1 p-2 hard-border-r">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">RIDE FEE</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.rideAlong} onChange={onAmtChange('rideAlong')}
                  className="w-full text-right border px-1 hard-border"/>
              </div>

              <div className="text-xs font-extrabold text-center mt-2 hard-border-b pb-1">RIDE BONUS</div>
              <div className="flex items-center mt-1">
                <span className="mr-1">$</span>
                <input type="text" inputMode="decimal" pattern="[0-9.]*" autoComplete="off"
                  value={data.rideAlongBonus} onChange={onAmtChange('rideAlongBonus')}
                  className="w-full text-right border px-1 hard-border"/>
              </div>
            </div>

            <div className="col-span-2 p-2" style="background:#e8f0ff">
              <div className="text-xs font-extrabold text-center mb-1 hard-border-b pb-1">AFTER FEES</div>
              <div className="text-xl font-extrabold text-center">{fmt(totalAfterFees)}</div>
            </div>

            <div className="col-span-1 p-2" style="background:#eaeaea">
              <div className="text-xs font-extrabold text-center mb-1">VETS %</div>
              <div className="text-2xl font-extrabold text-center">{vetRate}%</div>
              <div className="text-xs font-extrabold text-center mt-2">REPS %</div>
              <div className="text-2xl font-extrabold text-center">{repRate}%</div>
            </div>
          </div>

          {/* Names blocks */}
          <div className="grid grid-cols-12">
            <div className="col-span-9 p-4 hard-border-r mobile-full">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mobile-stack">
                <div>
                  <h3 className="text-sm font-extrabold mb-3 text-center hard-border-b pb-2">VETS</h3>
                  {Array.from({ length: parseNum(data.numVets) }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">VET {i+1}</label>
                      <input type="text" autoComplete="off"
                        value={(data.vetNames && data.vetNames[i]) || ''}
                        onChange={(e)=>{ const n=[...(data.vetNames||[])]; n[i]=e.target.value; onChange({...data, vetNames:n}); }}
                        className="w-full px-2 py-1 border rounded hard-border"/>
                    </div>
                  ))}
                </div>

                <div>
                  <h3 className="text-sm font-extrabold mb-3 text-center hard-border-b pb-2">REPS</h3>
                  {Array.from({ length: parseNum(data.numReps) }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">REP {i+1}</label>
                      <input type="text" autoComplete="off"
                        value={(data.repNames && data.repNames[i]) || ''}
                        onChange={(e)=>{ const n=[...(data.repNames||[])]; n[i]=e.target.value; onChange({...data, repNames:n}); }}
                        className="w-full px-2 py-1 border rounded hard-border"/>
                    </div>
                  ))}
                </div>

                <div>
                  <h3 className="text-sm font-extrabold mb-3 text-center hard-border-b pb-2">RIDE ALONGS</h3>
                  <div className="mb-3">
                    <label className="text-xs font-bold block mb-1 text-center"># OF PEOPLE</label>
                    <input type="text" inputMode="numeric" pattern="[0-9]*" autoComplete="off"
                      value={data.numRideAlongs || ''}
                      onChange={(e)=>onChange({...data, numRideAlongs:e.target.value.replace(/[^0-9]/g,'')})}
                      className="w-20 mx-auto block px-2 py-1 border-2 rounded text-center font-bold text-lg hard-border"
                      placeholder="0"/>
                  </div>
                  {Array.from({ length: parseNum(data.numRideAlongs) }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">RIDE ALONG {i+1}</label>
                      <input type="text" autoComplete="off"
                        value={(data.rideAlongNames && data.rideAlongNames[i]) || ''}
                        onChange={(e)=>{ const n=[...(data.rideAlongNames||[])]; n[i]=e.target.value; onChange({...data, rideAlongNames:n}); }}
                        className="w-full px-2 py-1 border rounded hard-border"/>
                    </div>
                  ))}
                  {parseNum(data.numRideAlongs) > 0 && (
                    <div className="mt-2 p-2 rounded hard-border text-center" style="background:#fff8d3">
                      <div className="text-xs font-extrabold">Per Person: {fmt(perRideAlong)}</div>
                    </div>
                  )}
                </div>
              </div>
            </div>

            <div className="col-span-3 p-2" style="background:#fff9db">
              <div className="grid grid-cols-3 gap-2 mb-2">
                <div className="text-xs font-extrabold text-center hard-border-b pb-1"># VETS</div>
                <div className="text-xs font-extrabold text-center hard-border-b pb-1">PER</div>
                <div className="text-xs font-extrabold text-center hard-border-b pb-1">TOTAL</div>
              </div>
              <div className="grid grid-cols-3 gap-2 mb-3">
                <input type="text" inputMode="numeric" pattern="[0-9]*" autoComplete="off"
                  value={data.numVets}
                  onChange={(e)=>onChange({...data, numVets:e.target.value.replace(/[^0-9]/g,'')})}
                  className="text-center border hard-border"/>
                <div className="text-center font-extrabold text-sm">
                  {parseNum(data.numVets) > 0 ? fmt(finalPerVet) : ''}
                </div>
                <div className="text-center font-extrabold text-sm">
                  {parseNum(data.numVets) > 0 ? fmt(finalPerVet * parseNum(data.numVets)) : ''}
                </div>
              </div>

              <div className="grid grid-cols-3 gap-2 mb-2">
                <div className="text-xs font-extrabold text-center hard-border-b pb-1"># REPS</div>
                <div className="text-xs font-extrabold text-center hard-border-b pb-1">PER</div>
                <div className="text-xs font-extrabold text-center hard-border-b pb-1">TOTAL</div>
              </div>
              <div className="grid grid-cols-3 gap-2 mb-3">
                <input type="text" inputMode="numeric" pattern="[0-9]*" autoComplete="off"
                  value={data.numReps}
                  onChange={(e)=>onChange({...data, numReps:e.target.value.replace(/[^0-9]/g,'')})}
                  className="text-center border hard-border"/>
                <div className="text-center font-extrabold text-sm">
                  {parseNum(data.numReps) > 0 ? fmt(finalPerRep) : ''}
                </div>
                <div className="text-center font-extrabold text-sm">
                  {parseNum(data.numReps) > 0 ? fmt(finalPerRep * parseNum(data.numReps)) : ''}
                </div>
              </div>

              <div className="grid grid-cols-2 gap-2 pt-2 hard-border-t">
                <div className="text-xs font-extrabold text-center">COMBINED</div>
                <div className="text-sm font-extrabold text-center bg-green-200 border hard-border p-1">
                  {fmt((finalPerVet * parseNum(data.numVets)) + (finalPerRep * parseNum(data.numReps)))}
                </div>
              </div>

              {parseNum(data.numRideAlongs) > 0 && (
                <>
                  <div className="grid grid-cols-3 gap-2 mb-2 pt-2 mt-2 hard-border-t">
                    <div className="text-xs font-extrabold text-center hard-border-b pb-1"># RIDE</div>
                    <div className="text-xs font-extrabold text-center hard-border-b pb-1">PER</div>
                    <div className="text-xs font-extrabold text-center hard-border-b pb-1">TOTAL</div>
                  </div>
                  <div className="grid grid-cols-3 gap-2 mb-2">
                    <div className="text-center font-extrabold text-sm">{rideAlongCount}</div>
                    <div className="text-center font-extrabold text-sm">{fmt(perRideAlong)}</div>
                    <div className="text-center font-extrabold text-sm bg-yellow-200 border hard-border p-1">
                      {fmt(totalRideAlong)}
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    }

    /* ===== App with Summary + Printing ===== */
    function App() {
      const blank = () => ({
        id: Date.now() + Math.random(),
        customerName:'', jobNumber:'',
        contractAmount:'', cashCheck:'',
        financeAmount:'', dealerFee:'',
        creditCard:'', creditCardFee:'',
        houseFeePercent:String(defaultHousePct(0)),
        houseFeeManual:false,
        laborMaterial:'',
        rideAlong:'', rideAlongBonus:'',
        numVets:'', numReps:'',
        vetNames:[], repNames:[],
        numRideAlongs:'', rideAlongNames:[]
      });

      const [calcs, setCalcs] = useState([ blank() ]);
      const mainRef  = useRef(null);
      const printRef = useRef(null);

      const calcData = (c) => {
        const contractAmount   = parseNum(c.contractAmount);
        const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
        const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
        const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
        const afterHouseFee    = contractAmount - houseFeeAmount;
        const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

        const pc = afterHouseFee > 0 ? (totalAfterFees / afterHouseFee) * 100 : 0;
        let vr=25; if(pc>=50) vr=55; else if(pc>=40) vr=45; else if(pc>=33) vr=35;
        let rr=20; if(pc>=50) rr=40; else if(pc>=40) rr=30; else if(pc>=33) rr=25;

        const vc = parseNum(c.numVets), rc = parseNum(c.numReps);
        const totalPeople = vc + rc;
        const vt = (totalAfterFees * vr) / 100;
        const rt = (totalAfterFees * rr) / 100;
        const perVet = totalPeople > 0 ? (vt / totalPeople) : 0;
        const perRep = totalPeople > 0 ? (rt / totalPeople) : 0;
        const rideAlongFeePer = totalPeople > 0 ? parseNum(c.rideAlong) / totalPeople : 0;
        const ccFeePer        = totalPeople > 0 ? creditCardFeeAmt / totalPeople : 0;

        const pv = perVet - rideAlongFeePer - ccFeePer;
        const pr = perRep - rideAlongFeePer - ccFeePer;

        const rac = parseNum(c.numRideAlongs);
        const tra = parseNum(c.rideAlong) + parseNum(c.rideAlongBonus);
        const pra = rac > 0 ? tra / rac : 0;

        return { vr, rr, vc, rc, vt, rt, pv, pr, pc, rac, pra, tra };
      };

      const totals = calcs.reduce((acc, c) => {
        const d = calcData(c);
        acc.v += d.pv * parseNum(c.numVets);
        acc.r += d.pr * parseNum(c.numReps);
        acc.rideFee += parseNum(c.rideAlong);
        acc.rideBonus += parseNum(c.rideAlongBonus);
        return acc;
      }, { v:0, r:0, rideFee:0, rideBonus:0 });
      const totalCompany = totals.v + totals.r + totals.rideBonus; // fee excluded

      const showPrintHTML = (html) => {
        if (!printRef.current || !mainRef.current) return;
        printRef.current.innerHTML = html;
        mainRef.current.style.display = 'none';
        printRef.current.style.display = 'block';
        setTimeout(()=>window.print(), 30);
        // After printing, restore view:
        const restore = () => {
          if (mainRef.current && printRef.current) {
            mainRef.current.style.display = 'block';
            printRef.current.style.display = 'none';
            printRef.current.innerHTML = '';
          }
          window.removeEventListener('afterprint', restore);
        };
        window.addEventListener('afterprint', restore);
      };

      /* Print ONE (fit page; no combined totals; include names & per-person payouts) */
      const printOne = (idx) => {
        const c = calcs[idx];
        const d = calcData(c);

        const contractAmount   = parseNum(c.contractAmount);
        const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
        const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
        const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
        const afterHouseFee    = contractAmount - houseFeeAmount;
        const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

        const companyPayout = (d.pv * d.vc) + (d.pr * d.rc) + (parseNum(c.rideAlongBonus)); // fee excluded

        const listBlock = (title, names, perAmount, borderHex) => {
          const rows = (names || []).map((n, i) => `
            <div style="display:flex;justify-content:space-between;align-items:center;background:#fff;padding:8px 10px;border:2px solid #000;border-radius:8px;margin-bottom:8px">
              <div style="font-weight:800;font-size:14px">${(n && n.trim()) ? n.trim() : (title.slice(0,-1) + ' ' + (i+1))}</div>
              <div style="font-weight:900;font-size:16px;color:#000">${fmt(perAmount)}</div>
            </div>
          `).join('');
          return `
            <div style="padding:10px;border:2px solid #000;border-radius:10px;margin-bottom:12px">
              <div style="font-weight:900;font-size:14px;margin-bottom:8px;border-bottom:2px solid #000;padding-bottom:4px">${title}</div>
              ${rows || '<div style="font-size:12px;color:#333">No names entered.</div>'}
            </div>
          `;
        };

        let rideBlocks = '';
        if (d.rac > 0) {
          for (let j=0; j<d.rac; j++) {
            const nm = (c.rideAlongNames && c.rideAlongNames[j]) || `Ride Along ${j+1}`;
            rideBlocks += `
              <div style="display:flex;justify-content:space-between;align-items:center;background:#fff;padding:8px 10px;border:2px solid #000;border-radius:8px;margin-bottom:8px">
                <div style="font-weight:800;font-size:14px">${nm}</div>
                <div style="font-weight:900;font-size:16px;color:#000">${fmt(d.pra)}</div>
              </div>
            `;
          }
        }

        const html = `
          <div style="width:7.5in; margin:0 auto; color:#000; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; line-height:1.25;">
            <div style="text-align:center;font-size:20px;font-weight:900;border-bottom:3px solid #000;padding-bottom:10px;margin-bottom:14px">
              FILE #${idx+1} — ${c.customerName ? c.customerName.replace(/</g,'&lt;') : 'N/A'}
            </div>
            <div style="text-align:center;font-size:13px;margin-bottom:12px">
              <strong>Job #:</strong> ${c.jobNumber ? c.jobNumber.replace(/</g,'&lt;') : 'N/A'}
            </div>

            <div style="border:2px solid #000;border-radius:10px;padding:10px;margin-bottom:12px">
              <div style="font-weight:900;border-bottom:2px solid #000;padding-bottom:4px;margin-bottom:6px">CONTRACT DETAILS</div>
              <div style="font-size:12px;display:grid;grid-template-columns:1fr 1fr;gap:6px">
                <div><strong>Contract:</strong> ${fmt(contractAmount)}</div>
                <div><strong>House Fee (${c.houseFeePercent||0}%):</strong> ${fmt(houseFeeAmount)}</div>
                <div><strong>Cash/Check:</strong> ${fmt(parseNum(c.cashCheck))}</div>
                <div><strong>Dealer Fee (${c.dealerFee||0}%):</strong> ${fmt(dealerFeeAmount)}</div>
                <div><strong>Finance:</strong> ${fmt(parseNum(c.financeAmount))}</div>
                <div><strong>Credit Card (${c.creditCardFee||0}%):</strong> ${fmt(creditCardFeeAmt)}</div>
                <div><strong>Labor/Material:</strong> ${fmt(parseNum(c.laborMaterial))}</div>
                <div><strong>Ride Fee:</strong> ${fmt(parseNum(c.rideAlong))}</div>
              </div>
              <div style="margin-top:6px;font-size:12px;text-align:center;border-top:2px solid #000;padding-top:6px">
                <strong>Total After Fees:</strong> ${fmt(totalAfterFees)}
              </div>
              <div style="margin-top:6px;font-size:12px;text-align:center;">
                <strong>Profit Margin:</strong> ${(d.pc||0).toFixed(1)}% &nbsp;•&nbsp; <strong>Vet Rate:</strong> ${d.vr}% &nbsp;•&nbsp; <strong>Rep Rate:</strong> ${d.rr}%
              </div>
            </div>

            ${d.vc>0 ? listBlock('VETS', (c.vetNames||[]).slice(0,d.vc), d.pv, '#000') : ''}
            ${d.rc>0 ? listBlock('REPS', (c.repNames||[]).slice(0,d.rc), d.pr, '#000') : ''}

            ${d.rac>0 ? `
              <div style="border:2px solid #000;border-radius:10px;padding:10px;margin-bottom:12px">
                <div style="font-weight:900;border-bottom:2px solid #000;padding-bottom:4px;margin-bottom:6px">RIDE ALONGS</div>
                ${rideBlocks}
                <div style="font-size:12px;text-align:center;border-top:2px solid #000;padding-top:6px"><strong>Total Ride (Fee+Bonus):</strong> ${fmt(d.tra)}</div>
              </div>` : ''}

            <div style="text-align:right;font-size:14px;margin-top:6px;border-top:3px solid #000;padding-top:6px">
              <strong>Total Payout (includes ride-along bonus only):</strong> ${fmt(companyPayout)}
            </div>
          </div>
        `;
        showPrintHTML(html);
      };

      /* Print SUMMARY (overall cards; high-contrast) */
      const printSummary = () => {
        const html = `
          <div style="width:7.5in;margin:0 auto;color:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;">
            <div style="text-align:center;font-size:20px;font-weight:900;border-bottom:3px solid #000;padding-bottom:10px;margin-bottom:14px">
              PAYOUT SUMMARY
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px">
              <div style="background:#d2f8df;border:3px solid #000;border-radius:12px;padding:14px;text-align:center;">
                <div style="font-weight:900;margin-bottom:4px">TOTAL VET PAYOUT</div>
                <div style="font-size:24px;font-weight:900">${fmt(totals.v)}</div>
              </div>
              <div style="background:#e7d6ff;border:3px solid #000;border-radius:12px;padding:14px;text-align:center;">
                <div style="font-weight:900;margin-bottom:4px">TOTAL REP PAYOUT</div>
                <div style="font-size:24px;font-weight:900">${fmt(totals.r)}</div>
              </div>
              <div style="background:#fff2c2;border:3px solid #000;border-radius:12px;padding:14px;text-align:center;">
                <div style="font-weight:900;margin-bottom:4px">TOTAL RIDE-ALONG (FEE + BONUS)</div>
                <div style="font-size:24px;font-weight:900">${fmt(totals.rideFee + totals.rideBonus)}</div>
                <div style="font-size:12px;margin-top:2px">Bonus Only: ${fmt(totals.rideBonus)}</div>
              </div>
              <div style="background:#d9ebff;border:3px solid #000;border-radius:12px;padding:14px;text-align:center;">
                <div style="font-weight:900;margin-bottom:4px">TOTAL PAYOUT (COMPANY)</div>
                <div style="font-size:24px;font-weight:900">${fmt(totalCompany)}</div>
                <div style="font-size:12px;margin-top:2px">Vet + Rep + Ride Bonus (Fee Excluded)</div>
              </div>
            </div>
          </div>
        `;
        showPrintHTML(html);
      };

      /* Print ALL FILES (kept high-contrast + names + per-person payouts per file; multiple pages) */
      const printAllFiles = () => {
        let html = '';
        const listBlock = (title, names, perAmount) => {
          const rows = (names||[]).map((n,i)=>`
            <div style="display:flex;justify-content:space-between;align-items:center;background:#fff;padding:8px 10px;border:2px solid #000;border-radius:8px;margin-bottom:8px">
              <div style="font-weight:800;font-size:14px">${(n&&n.trim())?n.trim():(title.slice(0,-1)+' '+(i+1))}</div>
              <div style="font-weight:900;font-size:16px;color:#000">${fmt(perAmount)}</div>
            </div>`).join('');
          return `
            <div style="padding:10px;border:2px solid #000;border-radius:10px;margin-bottom:12px">
              <div style="font-weight:900;border-bottom:2px solid #000;padding-bottom:4px;margin-bottom:6px">${title}</div>
              ${rows || '<div style="font-size:12px;color:#333">No names entered.</div>'}
            </div>`;
        };

        calcs.forEach((c, i) => {
          const d = calcData(c);
          const contractAmount   = parseNum(c.contractAmount);
          const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
          const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
          const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
          const afterHouseFee    = contractAmount - houseFeeAmount;
          const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;
          const companyPayout    = (d.pv * d.vc) + (d.pr * d.rc) + parseNum(c.rideAlongBonus); // fee excluded

          let rideRows = '';
          if (d.rac>0) {
            for (let j=0;j<d.rac;j++){
              const nm=(c.rideAlongNames && c.rideAlongNames[j]) || `Ride Along ${j+1}`;
              rideRows+=`
                <div style="display:flex;justify-content:space-between;align-items:center;background:#fff;padding:8px 10px;border:2px solid #000;border-radius:8px;margin-bottom:8px">
                  <div style="font-weight:800;font-size:14px">${nm}</div>
                  <div style="font-weight:900;font-size:16px;color:#000">${fmt(d.pra)}</div>
                </div>`;
            }
          }

          html += `
            <div style="page-break-after:always;width:7.5in;margin:0 auto;color:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;">
              <div style="text-align:center;font-size:20px;font-weight:900;border-bottom:3px solid #000;padding-bottom:10px;margin-bottom:14px">
                FILE #${i+1} — ${c.customerName ? c.customerName.replace(/</g,'&lt;') : 'N/A'}
              </div>
              <div style="text-align:center;font-size:13px;margin-bottom:10px"><strong>Job #:</strong> ${c.jobNumber ? c.jobNumber.replace(/</g,'&lt;') : 'N/A'}</div>

              <div style="border:2px solid #000;border-radius:10px;padding:10px;margin-bottom:12px">
                <div style="font-weight:900;border-bottom:2px solid #000;padding-bottom:4px;margin-bottom:6px">CONTRACT DETAILS</div>
                <div style="font-size:12px;display:grid;grid-template-columns:1fr 1fr;gap:6px">
                  <div><strong>Contract:</strong> ${fmt(contractAmount)}</div>
                  <div><strong>House Fee (${c.houseFeePercent||0}%):</strong> ${fmt(houseFeeAmount)}</div>
                  <div><strong>Cash/Check:</strong> ${fmt(parseNum(c.cashCheck))}</div>
                  <div><strong>Dealer Fee (${c.dealerFee||0}%):</strong> ${fmt(dealerFeeAmount)}</div>
                  <div><strong>Finance:</strong> ${fmt(parseNum(c.financeAmount))}</div>
                  <div><strong>Credit Card (${c.creditCardFee||0}%):</strong> ${fmt(creditCardFeeAmt)}</div>
                  <div><strong>Labor/Material:</strong> ${fmt(parseNum(c.laborMaterial))}</div>
                  <div><strong>Ride Fee:</strong> ${fmt(parseNum(c.rideAlong))}</div>
                </div>
                <div style="margin-top:6px;font-size:12px;text-align:center;border-top:2px solid #000;padding-top:6px">
                  <strong>Total After Fees:</strong> ${fmt(totalAfterFees)}
                </div>
                <div style="margin-top:6px;font-size:12px;text-align:center;">
                  <strong>Profit Margin:</strong> ${(d.pc||0).toFixed(1)}% • <strong>Vet Rate:</strong> ${d.vr}% • <strong>Rep Rate:</strong> ${d.rr}%
                </div>
              </div>

              ${d.vc>0 ? listBlock('VETS', (c.vetNames||[]).slice(0,d.vc), d.pv) : ''}
              ${d.rc>0 ? listBlock('REPS', (c.repNames||[]).slice(0,d.rc), d.pr) : ''}

              ${d.rac>0 ? `
                <div style="border:2px solid #000;border-radius:10px;padding:10px;margin-bottom:12px">
                  <div style="font-weight:900;border-bottom:2px solid #000;padding-bottom:4px;margin-bottom:6px">RIDE ALONGS</div>
                  ${rideRows}
                  <div style="font-size:12px;text-align:center;border-top:2px solid #000;padding-top:6px"><strong>Total Ride (Fee+Bonus):</strong> ${fmt(d.tra)}</div>
                </div>` : ''}

              <div style="text-align:right;font-size:14px;margin-top:6px;border-top:3px solid #000;padding-top:6px">
                <strong>Total Payout (includes ride-along bonus only):</strong> ${fmt(companyPayout)}
              </div>
            </div>
          `;
        });

        showPrintHTML(html);
      };

      return (
        <div className="min-h-screen">
          <div ref={mainRef} className="p-4 no-print">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6 hard-border">
              <div className="flex flex-wrap gap-2 justify-between items-center mb-6">
                <h1 className="text-3xl font-extrabold">ALTA CAL PROFIT SHARE</h1>
                <div className="flex gap-2">
                  <button
                    onClick={printSummary}
                    className="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-4 rounded-lg flex items-center gap-2">
                    <Printer/> PRINT SUMMARY
                  </button>
                  <button
                    onClick={printAllFiles}
                    className="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-4 rounded-lg flex items-center gap-2">
                    <Printer/> PRINT ALL FILES
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-4 gap-4 max-w-6xl mx-auto">
                <div className="p-5 rounded-lg text-black hard-border" style="background:#d2f8df">
                  <div className="text-sm font-extrabold mb-1">TOTAL VET PAYOUT</div>
                  <div className="text-4xl font-extrabold">{fmt(totals.v)}</div>
                </div>
                <div className="p-5 rounded-lg text-black hard-border" style="background:#e7d6ff">
                  <div className="text-sm font-extrabold mb-1">TOTAL REP PAYOUT</div>
                  <div className="text-4xl font-extrabold">{fmt(totals.r)}</div>
                </div>
                <div className="p-5 rounded-lg text-black hard-border" style="background:#fff2c2">
                  <div className="text-sm font-extrabold mb-1">TOTAL RIDE-ALONG (FEE + BONUS)</div>
                  <div className="text-4xl font-extrabold">{fmt(totals.rideFee + totals.rideBonus)}</div>
                  <div className="text-xs">Bonus Only: {fmt(totals.rideBonus)}</div>
                </div>
                <div className="p-5 rounded-lg text-black hard-border" style="background:#d9ebff">
                  <div className="text-sm font-extrabold mb-1">TOTAL PAYOUT (COMPANY)</div>
                  <div className="text-4xl font-extrabold">{fmt(totalCompany)}</div>
                  <div className="text-xs">Vet + Rep + Ride Bonus (Fee Excluded)</div>
                </div>
              </div>
            </div>

            {calcs.map((c) => (
              <SingleCalculator
                key={c.id}
                data={c}
                onChange={(n)=>setCalcs(arr=>arr.map(x=>x.id===c.id?n:x))}
                onRemove={()=>setCalcs(arr=>arr.filter(x=>x.id!==c.id))}
                canRemove={calcs.length>1}
                onPrint={()=>{
                  const idx = calcs.findIndex(x=>x.id===c.id);
                  if (idx>=0) printOne(idx);
                }}
              />
            ))}

            <div className="text-center mt-6">
              <button
                onClick={()=>setCalcs(arr=>[...arr, blank()])}
                className="bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 px-8 rounded-full shadow-lg inline-flex items-center gap-2">
                <Plus/> ADD NEW FILE
              </button>
            </div>
          </div>

          <div ref={printRef} className="only-print"></div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
