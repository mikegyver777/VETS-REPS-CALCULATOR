<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home Improvement Contract Calculator</title>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel so JSX works in a static page -->
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CDN (works on static hosting) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media print { .no-print { display: none !important; } }
    input { -webkit-appearance: none; appearance: none; }
    input:focus { outline: 2px solid #3b82f6; }
    @media (max-width: 768px) {
      .grid-cols-12 { display: block !important; }
      .grid-cols-12 > div { width: 100% !important; border-right: none !important; border-bottom: 1px solid #000; }
      .grid-cols-12 > div:last-child { border-bottom: none; }
      .mobile-stack { grid-template-columns: 1fr !important; }
      .mobile-full { width: 100% !important; }
    }
    /* Ensure print view spans page width without Tailwind classes */
    #printView { background: #fff; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <!-- Your app. Important: data-presets so JSX compiles correctly on GH Pages -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useRef } = React;

    /* -------- Inline icons (no external packages) -------- */
    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );
    const Printer = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none"
           stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
    );

    /* -------- Helpers -------- */
    const fmt = (v) =>
      '$' + (Number.isFinite(+v) ? (+v) : 0)
              .toFixed(2)
              .replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    const parseNum = (v) => {
      const n = parseFloat(String(v ?? '').replace(/[,$]/g, ''));
      return Number.isFinite(n) ? n : 0;
    };

    /* -------- Single Calculator -------- */
    function SingleCalculator({ data, onChange, onRemove, canRemove, onPrint }) {
      const contractAmount     = parseNum(data.contractAmount);
      const houseFeePercent    = parseNum(data.houseFeePercent);
      const houseFeeAmount     = (contractAmount * houseFeePercent) / 100;

      const dealerFeeAmount    = (parseNum(data.financeAmount) * parseNum(data.dealerFee)) / 100;
      const creditCardFeeAmt   = (parseNum(data.creditCard) * parseNum(data.creditCardFee)) / 100;

      const afterHouseFee      = contractAmount - houseFeeAmount;
      const totalAfterFees     = afterHouseFee - parseNum(data.laborMaterial) - dealerFeeAmount;
      const percentOfContract  = afterHouseFee > 0 ? (totalAfterFees / afterHouseFee) * 100 : 0;

      let vetRate = 25;
      if (percentOfContract >= 50) vetRate = 55;
      else if (percentOfContract >= 40) vetRate = 45;
      else if (percentOfContract >= 33) vetRate = 35;

      let repRate = 20;
      if (percentOfContract >= 50) repRate = 40;
      else if (percentOfContract >= 40) repRate = 30;
      else if (percentOfContract >= 33) repRate = 25;

      const vetsCount          = parseNum(data.numVets);
      const repsCount          = parseNum(data.numReps);
      const totalPeople        = vetsCount + repsCount;

      const vetCommissionTotal = (totalAfterFees * vetRate) / 100;
      const repCommissionTotal = (totalAfterFees * repRate) / 100;

      const perVetPayout       = totalPeople > 0 ? (vetCommissionTotal / totalPeople) : 0;
      const perRepPayout       = totalPeople > 0 ? (repCommissionTotal / totalPeople) : 0;

      const rideAlongFeePer    = totalPeople > 0 ? parseNum(data.rideAlong) / totalPeople : 0;
      const ccFeePer           = totalPeople > 0 ? creditCardFeeAmt / totalPeople : 0;

      const finalPerVetPayout  = perVetPayout - rideAlongFeePer - ccFeePer;
      const finalPerRepPayout  = perRepPayout - rideAlongFeePer - ccFeePer;

      const rideAlongCount     = parseNum(data.numRideAlongs);
      const totalRideAlongPay  = parseNum(data.rideAlong) + parseNum(data.rideAlongBonus);
      const perRideAlongPayout = rideAlongCount > 0 ? totalRideAlongPay / rideAlongCount : 0;

      return (
        <div className="relative mb-6 bg-white border-4 border-gray-300 rounded-lg">
          {canRemove && (
            <button
              onClick={onRemove}
              className="absolute -top-3 -right-3 bg-red-600 text-white rounded-full p-2 hover:bg-red-700 z-10 shadow-lg"
              title="Remove"
            >
              <X size={20} />
            </button>
          )}

          <button
            onClick={onPrint}
            className="absolute -top-3 -left-3 bg-green-600 text-white rounded-full p-2 hover:bg-green-700 z-10 shadow-lg"
            title="Print"
          >
            <Printer size={20} />
          </button>

          <div className="bg-blue-300 py-3 px-4 border-b-2 border-black">
            <div className="grid grid-cols-3 gap-4 items-center">
              <div>
                <label className="text-xs font-bold text-black block mb-1">CUSTOMER NAME</label>
                <input
                  type="text"
                  value={data.customerName}
                  onChange={(e) => onChange({ ...data, customerName: e.target.value })}
                  className="w-full px-2 py-1 border-2 border-black rounded"
                />
              </div>

              <h2 className="text-lg font-bold text-black text-center">PROFIT SHARE CALCULATOR</h2>

              <div>
                <label className="text-xs font-bold text-black block mb-1">JOB NUMBER</label>
                <input
                  type="text"
                  value={data.jobNumber}
                  onChange={(e) => onChange({ ...data, jobNumber: e.target.value })}
                  className="w-full px-2 py-1 border-2 border-black rounded"
                />
              </div>
            </div>
          </div>

          <div className="grid grid-cols-12 border-b-2 border-black">
            <div className="col-span-1 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">CONTRACT AMOUNT</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.contractAmount}
                  onChange={(e) =>
                    onChange({ ...data, contractAmount: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>
            </div>

            <div className="col-span-1 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">CASH</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.cashCheck}
                  onChange={(e) =>
                    onChange({ ...data, cashCheck: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>
            </div>

            <div className="col-span-2 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">FINANCE</div>
              <div className="grid grid-cols-2 gap-1">
                <div className="flex items-center">
                  <span className="text-xs mr-1">$</span>
                  <input
                    type="text"
                    inputMode="decimal"
                    value={data.financeAmount}
                    onChange={(e) =>
                      onChange({ ...data, financeAmount: e.target.value.replace(/[^0-9.]/g, '') })
                    }
                    className="w-full text-right border border-gray-300 px-1"
                  />
                </div>
                <div className="flex items-center">
                  <span className="text-xs mr-1">D%</span>
                  <input
                    type="text"
                    inputMode="decimal"
                    value={data.dealerFee}
                    onChange={(e) => onChange({ ...data, dealerFee: e.target.value })}
                    className="w-full text-right border border-gray-300 px-1"
                  />
                </div>
              </div>
            </div>

            <div className="col-span-2 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">CC</div>
              <div className="grid grid-cols-2 gap-1">
                <div className="flex items-center">
                  <span className="mr-1">$</span>
                  <input
                    type="text"
                    inputMode="decimal"
                    value={data.creditCard}
                    onChange={(e) =>
                      onChange({ ...data, creditCard: e.target.value.replace(/[^0-9.]/g, '') })
                    }
                    className="w-full text-right border border-gray-300 px-1"
                  />
                </div>
                <div className="flex items-center">
                  <span className="text-xs mr-1">%</span>
                  <input
                    type="text"
                    inputMode="decimal"
                    value={data.creditCardFee}
                    onChange={(e) => onChange({ ...data, creditCardFee: e.target.value })}
                    className="w-full text-right border border-gray-300 px-1"
                  />
                </div>
              </div>
            </div>

            <div className="col-span-1 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">HOUSE</div>
              <div className="flex items-center mb-1">
                <span className="text-xs mr-1">%</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.houseFeePercent}
                  onChange={(e) =>
                    onChange({ ...data, houseFeePercent: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>
              <div className="text-xs font-bold text-right">{fmt(houseFeeAmount)}</div>
            </div>

            <div className="col-span-1 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">LABOR</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.laborMaterial}
                  onChange={(e) =>
                    onChange({ ...data, laborMaterial: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>
            </div>

            <div className="col-span-1 border-r-2 border-black p-2">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">RIDE ALONG FEE</div>
              <div className="flex items-center">
                <span className="mr-1">$</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.rideAlong}
                  onChange={(e) =>
                    onChange({ ...data, rideAlong: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>

              <div className="text-xs font-bold text-center mt-2 border-b border-black pb-1">RIDE ALONG BONUS</div>
              <div className="flex items-center mt-1">
                <span className="mr-1">$</span>
                <input
                  type="text"
                  inputMode="decimal"
                  value={data.rideAlongBonus}
                  onChange={(e) =>
                    onChange({ ...data, rideAlongBonus: e.target.value.replace(/[^0-9.]/g, '') })
                  }
                  className="w-full text-right border border-gray-300 px-1"
                />
              </div>
            </div>

            <div className="col-span-2 border-r-2 border-black p-2 bg-gray-100">
              <div className="text-xs font-bold text-center mb-1 border-b border-black pb-1">AFTER FEES</div>
              <div className="text-xl font-bold text-center">{fmt(totalAfterFees)}</div>
            </div>

            <div className="col-span-1 border-black p-2 bg-gray-100">
              <div className="text-xs font-bold text-center mb-1">VETS %</div>
              <div className="text-2xl font-bold text-center">{vetRate}%</div>
              <div className="text-xs font-bold text-center mt-2">REP %</div>
              <div className="text-2xl font-bold text-center">{repRate}%</div>
            </div>
          </div>

          <div className="grid grid-cols-12">
            <div className="col-span-9 border-r-2 border-black p-4 mobile-full">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mobile-stack">

                <div>
                  <h3 className="text-sm font-bold mb-3 text-center border-b-2 border-black pb-2">VETS</h3>
                  {Array.from({ length: vetsCount }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">VET {i + 1}</label>
                      <input
                        type="text"
                        value={(data.vetNames && data.vetNames[i]) || ''}
                        onChange={(e) => {
                          const n = [ ...(data.vetNames || []) ];
                          n[i] = e.target.value;
                          onChange({ ...data, vetNames: n });
                        }}
                        className="w-full px-2 py-1 border border-gray-400 rounded"
                      />
                    </div>
                  ))}
                </div>

                <div>
                  <h3 className="text-sm font-bold mb-3 text-center border-b-2 border-black pb-2">REPS</h3>
                  {Array.from({ length: repsCount }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">REP {i + 1}</label>
                      <input
                        type="text"
                        value={(data.repNames && data.repNames[i]) || ''}
                        onChange={(e) => {
                          const n = [ ...(data.repNames || []) ];
                          n[i] = e.target.value;
                          onChange({ ...data, repNames: n });
                        }}
                        className="w-full px-2 py-1 border border-gray-400 rounded"
                      />
                    </div>
                  ))}
                </div>

                <div>
                  <h3 className="text-sm font-bold mb-3 text-center border-b-2 border-black pb-2">RIDE ALONGS</h3>

                  <div className="mb-3">
                    <label className="text-xs font-bold block mb-1 text-center"># OF PEOPLE</label>
                    <input
                      type="text"
                      inputMode="numeric"
                      value={data.numRideAlongs || ''}
                      onChange={(e) =>
                        onChange({ ...data, numRideAlongs: e.target.value.replace(/[^0-9]/g, '') })
                      }
                      className="w-20 mx-auto block px-2 py-1 border-2 border-gray-400 rounded text-center font-bold text-lg"
                      placeholder="0"
                    />
                  </div>

                  {Array.from({ length: rideAlongCount }, (_, i) => (
                    <div key={i} className="mb-2">
                      <label className="text-xs font-bold block mb-1">RIDE ALONG {i + 1}</label>
                      <input
                        type="text"
                        value={(data.rideAlongNames && data.rideAlongNames[i]) || ''}
                        onChange={(e) => {
                          const n = [ ...(data.rideAlongNames || []) ];
                          n[i] = e.target.value;
                          onChange({ ...data, rideAlongNames: n });
                        }}
                        className="w-full px-2 py-1 border border-gray-400 rounded"
                      />
                    </div>
                  ))}

                  {rideAlongCount > 0 && (
                    <div className="mt-2 p-2 bg-yellow-100 rounded border border-yellow-500 text-center">
                      <div className="text-xs font-bold">Per Person: {fmt(perRideAlongPayout)}</div>
                    </div>
                  )}
                </div>
              </div>
            </div>

            <div className="col-span-3 p-2 bg-yellow-50">
              <div className="grid grid-cols-3 gap-2 mb-2">
                <div className="text-xs font-bold text-center border-b border-black pb-1"># VETS</div>
                <div className="text-xs font-bold text-center border-b border-black pb-1">PER</div>
                <div className="text-xs font-bold text-center border-b border-black pb-1">TOTAL</div>
              </div>

              <div className="grid grid-cols-3 gap-2 mb-3">
                <input
                  type="text"
                  inputMode="numeric"
                  value={data.numVets}
                  onChange={(e) => onChange({ ...data, numVets: e.target.value.replace(/[^0-9]/g, '') })}
                  className="text-center border border-black"
                />
                <div className="text-center font-bold text-sm">{vetsCount > 0 ? fmt(finalPerVetPayout) : ''}</div>
                <div className="text-center font-bold text-sm">{vetsCount > 0 ? fmt(finalPerVetPayout * vetsCount) : ''}</div>
              </div>

              <div className="grid grid-cols-3 gap-2 mb-2">
                <div className="text-xs font-bold text-center border-b border-black pb-1"># REPS</div>
                <div className="text-xs font-bold text-center border-b border-black pb-1">PER</div>
                <div className="text-xs font-bold text-center border-b border-black pb-1">TOTAL</div>
              </div>

              <div className="grid grid-cols-3 gap-2 mb-3">
                <input
                  type="text"
                  inputMode="numeric"
                  value={data.numReps}
                  onChange={(e) => onChange({ ...data, numReps: e.target.value.replace(/[^0-9]/g, '') })}
                  className="text-center border border-black"
                />
                <div className="text-center font-bold text-sm">{repsCount > 0 ? fmt(finalPerRepPayout) : ''}</div>
                <div className="text-center font-bold text-sm">{repsCount > 0 ? fmt(finalPerRepPayout * repsCount) : ''}</div>
              </div>

              <div className="grid grid-cols-2 gap-2 pt-2 border-t-2 border-black">
                <div className="text-xs font-bold text-center">COMBINED</div>
                <div className="text-sm font-bold text-center bg-green-200 border border-black p-1">
                  {fmt((finalPerVetPayout * vetsCount) + (finalPerRepPayout * repsCount))}
                </div>
              </div>

              {rideAlongCount > 0 && (
                <>
                  <div className="grid grid-cols-3 gap-2 mb-2 pt-2 mt-2 border-t-2 border-black">
                    <div className="text-xs font-bold text-center border-b border-black pb-1"># RIDE ALONGS</div>
                    <div className="text-xs font-bold text-center border-b border-black pb-1">PER</div>
                    <div className="text-xs font-bold text-center border-b border-black pb-1">TOTAL</div>
                  </div>
                  <div className="grid grid-cols-3 gap-2 mb-2">
                    <div className="text-center font-bold text-sm">{rideAlongCount}</div>
                    <div className="text-center font-bold text-sm">{fmt(perRideAlongPayout)}</div>
                    <div className="text-center font-bold text-sm bg-yellow-200 border border-black p-1">
                      {fmt(totalRideAlongPay)}
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    }

    /* -------- App -------- */
    function App() {
      const blank = () => ({
        id: Date.now() + Math.random(),
        customerName:'', jobNumber:'',
        contractAmount:'', cashCheck:'',
        financeAmount:'', dealerFee:'',
        creditCard:'', creditCardFee:'',
        houseFeePercent:'', laborMaterial:'',
        rideAlong:'', rideAlongBonus:'',
        rideAlongName:'', numVets:'', numReps:'',
        vetNames:[], repNames:[],
        numRideAlongs:'', rideAlongNames:[]
      });

      const [calcs, setCalcs] = useState([ blank() ]);
      const mainViewRef  = useRef(null);
      const printViewRef = useRef(null);

      // totals card
      const totals = calcs.reduce((acc, c) => {
        const contractAmount   = parseNum(c.contractAmount);
        const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
        const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
        const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
        const afterHouseFee    = contractAmount - houseFeeAmount;
        const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

        const pc = afterHouseFee > 0 ? (totalAfterFees / afterHouseFee) * 100 : 0;

        let vr = 25;
        if (pc >= 50) vr = 55; else if (pc >= 40) vr = 45; else if (pc >= 33) vr = 35;
        let rr = 20;
        if (pc >= 50) rr = 40; else if (pc >= 40) rr = 30; else if (pc >= 33) rr = 25;

        const vc = parseNum(c.numVets);
        const rc = parseNum(c.numReps);
        const totalPeople = vc + rc;

        const vt = (totalAfterFees * vr) / 100;
        const rt = (totalAfterFees * rr) / 100;

        const perVet = totalPeople > 0 ? (vt / totalPeople) : 0;
        const perRep = totalPeople > 0 ? (rt / totalPeople) : 0;

        const rideAlongFeePer = totalPeople > 0 ? parseNum(c.rideAlong) / totalPeople : 0;
        const ccFeePer        = totalPeople > 0 ? creditCardFeeAmt / totalPeople : 0;

        const finalPerVet = perVet - rideAlongFeePer - ccFeePer;
        const finalPerRep = perRep - rideAlongFeePer - ccFeePer;

        acc.v += finalPerVet * vc;
        acc.r += finalPerRep * rc;
        return acc;
      }, { v:0, r:0 });

      const calcData = (c) => {
        const contractAmount   = parseNum(c.contractAmount);
        const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
        const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
        const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
        const afterHouseFee    = contractAmount - houseFeeAmount;
        const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

        const pc = afterHouseFee > 0 ? (totalAfterFees / afterHouseFee) * 100 : 0;

        let vr = 25;
        if (pc >= 50) vr = 55; else if (pc >= 40) vr = 45; else if (pc >= 33) vr = 35;
        let rr = 20;
        if (pc >= 50) rr = 40; else if (pc >= 40) rr = 30; else if (pc >= 33) rr = 25;

        const vc = parseNum(c.numVets);
        const rc = parseNum(c.numReps);
        const totalPeople = vc + rc;

        const vt = (totalAfterFees * vr) / 100;
        const rt = (totalAfterFees * rr) / 100;

        const perVet = totalPeople > 0 ? (vt / totalPeople) : 0;
        const perRep = totalPeople > 0 ? (rt / totalPeople) : 0;

        const rideAlongFeePer = totalPeople > 0 ? parseNum(c.rideAlong) / totalPeople : 0;
        const ccFeePer        = totalPeople > 0 ? creditCardFeeAmt / totalPeople : 0;

        const finalPerVet = perVet - rideAlongFeePer - ccFeePer;
        const finalPerRep = perRep - rideAlongFeePer - ccFeePer;

        const rac = parseNum(c.numRideAlongs);
        const tra = parseNum(c.rideAlong) + parseNum(c.rideAlongBonus);
        const pra = rac > 0 ? tra / rac : 0;

        return { vr, rr, vc, rc, vt, rt, pv: finalPerVet, pr: finalPerRep, pc, rac, pra, tra };
      };

      const showPrint = (html) => {
        if (!printViewRef.current || !mainViewRef.current) return;
        printViewRef.current.innerHTML = html;
        mainViewRef.current.style.display = 'none';
        printViewRef.current.style.display = 'block';

        // Attach fresh listeners to dynamically injected buttons
        setTimeout(() => {
          const printBtns = printViewRef.current.querySelectorAll('.print-btn');
          const closeBtns = printViewRef.current.querySelectorAll('.close-btn');

          printBtns.forEach((btn) => {
            const b = btn.cloneNode(true);
            btn.parentNode.replaceChild(b, btn);
            b.addEventListener('click', (e) => {
              e.preventDefault();
              window.print();
            }, true);
          });

          closeBtns.forEach((btn) => {
            const b = btn.cloneNode(true);
            btn.parentNode.replaceChild(b, btn);
            b.addEventListener('click', (e) => {
              e.preventDefault();
              if (!printViewRef.current || !mainViewRef.current) return;
              mainViewRef.current.style.display = 'block';
              printViewRef.current.style.display = 'none';
            }, true);
          });
        }, 50);
      };

      const printOne = (i) => {
        const c = calcs[i];
        const d = calcData(c);

        const contractAmount   = parseNum(c.contractAmount);
        const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
        const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
        const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
        const afterHouseFee    = contractAmount - houseFeeAmount;
        const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

        let html = `
          <div style="padding:20px;background:white;max-width:100%;overflow-x:hidden">
            <h1 style="text-align:center;font-size:24px;font-weight:bold;border-bottom:4px solid #2563eb;padding-bottom:15px;margin-bottom:20px;word-wrap:break-word">
              FILE #${i+1} - ${c.customerName || 'N/A'}
            </h1>
            <div style="text-align:center;font-size:16px;margin-bottom:20px"><strong>Job Number:</strong> ${c.jobNumber || 'N/A'}</div>
        `;

        if (d.vc > 0 || d.rc > 0) {
          html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:25px">`;
          if (d.vc > 0) {
            html += `<div style="background:#dcfce7;padding:20px;border-radius:12px;border:4px solid #16a34a;text-align:center"><div style="font-weight:bold;font-size:12px;margin-bottom:8px">TOTAL VET PAYOUT</div><div style="font-size:28px;font-weight:bold">${fmt(d.pv * d.vc)}</div></div>`;
          }
          if (d.rc > 0) {
            html += `<div style="background:#f3e8ff;padding:20px;border-radius:12px;border:4px solid #9333ea;text-align:center"><div style="font-weight:bold;font-size:12px;margin-bottom:8px">TOTAL REP PAYOUT</div><div style="font-size:28px;font-weight:bold">${fmt(d.pr * d.rc)}</div></div>`;
          }
          html += `</div>`;
        }

        html += `
          <div style="background:#dbeafe;padding:15px;border-radius:10px;border:2px solid #2563eb;margin-bottom:20px">
            <h3 style="font-weight:bold;margin-bottom:12px;font-size:14px">CONTRACT DETAILS</h3>
            <div style="display:grid;grid-template-columns:1fr;gap:8px;font-size:13px">
              <div><strong>Contract Amount:</strong> ${fmt(contractAmount)}</div>
              <div><strong>Cash/Check:</strong> ${fmt(parseNum(c.cashCheck))}</div>
              <div><strong>Finance Amount:</strong> ${fmt(parseNum(c.financeAmount))}</div>
              <div><strong>House Fee (${c.houseFeePercent || 0}%):</strong> ${fmt(houseFeeAmount)}</div>
              <div><strong>Dealer Fee (${c.dealerFee || 0}%):</strong> ${fmt(dealerFeeAmount)}</div>
              <div><strong>Credit Card (${c.creditCardFee || 0}%):</strong> ${fmt(creditCardFeeAmt)}</div>
              <div><strong>Labor & Material:</strong> ${fmt(parseNum(c.laborMaterial))}</div>
              <div><strong>Ride Along Fee:</strong> ${fmt(parseNum(c.rideAlong))}</div>
              <div style="background:#bfdbfe;padding:8px;border-radius:6px;text-align:center;margin-top:8px">
                <strong>Total After Fees:</strong> ${fmt(totalAfterFees)}
              </div>
            </div>
          </div>
        `;

        if (d.vc > 0) {
          html += `
            <div style="background:#dcfce7;padding:20px;border-radius:12px;border:4px solid #16a34a;margin-bottom:20px">
              <h3 style="font-size:18px;font-weight:bold;margin-bottom:15px;color:#166534;border-bottom:2px solid #16a34a;padding-bottom:8px">VETS (${d.vc})</h3>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-bottom:12px;font-size:12px"><strong>Profit Margin:</strong> ${d.pc ? d.pc.toFixed(1) : '0.0'}% ‚Üí <strong>Vet Rate:</strong> ${d.vr}%</div>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-bottom:12px;font-size:12px"><strong>Per Person Payout:</strong> ${fmt(d.pv)}</div>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;font-size:12px"><strong>Total Vet Payout:</strong> ${fmt(d.pv * d.vc)}</div>
            </div>
          `;
        }

        if (d.rc > 0) {
          html += `
            <div style="background:#f3e8ff;padding:20px;border-radius:12px;border:4px solid #9333ea;margin-bottom:20px">
              <h3 style="font-size:18px;font-weight:bold;margin-bottom:15px;color:#7e22ce;border-bottom:2px solid #9333ea;padding-bottom:8px">SALES REPS (${d.rc})</h3>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-bottom:12px;font-size:12px"><strong>Profit Margin:</strong> ${d.pc ? d.pc.toFixed(1) : '0.0'}% ‚Üí <strong>Rep Rate:</strong> ${d.rr}%</div>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-bottom:12px;font-size:12px"><strong>Per Person Payout:</strong> ${fmt(d.pr)}</div>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;font-size:12px"><strong>Total Rep Payout:</strong> ${fmt(d.pr * d.rc)}</div>
            </div>
          `;
        }

        if (d.rac > 0) {
          html += `
            <div style="background:#fef3c7;padding:20px;border-radius:12px;border:4px solid #eab308;margin-bottom:20px">
              <h3 style="font-size:18px;font-weight:bold;margin-bottom:15px;color:#a16207;border-bottom:2px solid #eab308;padding-bottom:8px">RIDE ALONG (${d.rac})</h3>
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-bottom:12px;font-size:12px"><strong>Per Ride Along:</strong> ${fmt(d.pra)}</div>
          `;
          for (let j = 0; j < d.rac; j++) {
            const n = (c.rideAlongNames && c.rideAlongNames[j]) || `Ride Along ${j + 1}`;
            html += `
              <div style="background:white;padding:15px;border-radius:10px;border:2px solid #eab308;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
                <div style="font-weight:bold;font-size:16px;margin-right:10px">${n}</div>
                <div style="font-weight:bold;font-size:22px;color:#eab308">${fmt(d.pra)}</div>
              </div>
            `;
          }
          html += `
              <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-top:12px;font-size:12px"><strong>Total Ride Along Payout:</strong> ${fmt(d.tra)}</div>
            </div>
          `;
        }

        html += `
          <div style="text-align:center;margin-top:30px">
            <button class="print-btn" style="background:#2563eb;color:white;padding:12px 30px;border:none;border-radius:10px;font-weight:bold;font-size:16px;margin-right:10px;cursor:pointer">üñ®Ô∏è PRINT</button>
            <button class="close-btn" style="background:#6b7280;color:white;padding:12px 30px;border:none;border-radius:10px;font-weight:bold;font-size:16px;cursor:pointer">CLOSE</button>
          </div>
        </div>`;

        showPrint(html);
      };

      const printAllFiles = () => {
        let html = '';
        calcs.forEach((c, i) => {
          const d = calcData(c);

          const contractAmount   = parseNum(c.contractAmount);
          const houseFeeAmount   = (contractAmount * parseNum(c.houseFeePercent)) / 100;
          const dealerFeeAmount  = (parseNum(c.financeAmount) * parseNum(c.dealerFee)) / 100;
          const creditCardFeeAmt = (parseNum(c.creditCard) * parseNum(c.creditCardFee)) / 100;
          const afterHouseFee    = contractAmount - houseFeeAmount;
          const totalAfterFees   = afterHouseFee - parseNum(c.laborMaterial) - dealerFeeAmount;

          html += `
            <div style="padding:20px;page-break-after:always;max-width:100%;overflow-x:hidden">
              <h1 style="text-align:center;font-size:22px;font-weight:bold;border-bottom:4px solid #2563eb;padding-bottom:12px;margin-bottom:20px;word-wrap:break-word">
                FILE #${i+1} - ${c.customerName || 'N/A'}
              </h1>
              <div style="text-align:center;font-size:15px;margin-bottom:20px"><strong>Job Number:</strong> ${c.jobNumber || 'N/A'}</div>
          `;

          if (d.vc > 0 || d.rc > 0) {
            html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px">`;
            if (d.vc > 0) {
              html += `<div style="background:#dcfce7;padding:18px;border-radius:10px;border:3px solid #16a34a;text-align:center"><div style="font-weight:bold;font-size:11px;margin-bottom:6px">TOTAL VET PAYOUT</div><div style="font-size:24px;font-weight:bold">${fmt(d.pv * d.vc)}</div></div>`;
            }
            if (d.rc > 0) {
              html += `<div style="background:#f3e8ff;padding:18px;border-radius:10px;border:3px solid #9333ea;text-align:center"><div style="font-weight:bold;font-size:11px;margin-bottom:6px">TOTAL REP PAYOUT</div><div style="font-size:24px;font-weight:bold">${fmt(d.pr * d.rc)}</div></div>`;
            }
            html += `</div>`;
          }

          html += `
            <div style="background:#dbeafe;padding:12px;border-radius:8px;border:2px solid #2563eb;margin-bottom:18px">
              <h3 style="font-weight:bold;margin-bottom:10px;font-size:13px">CONTRACT DETAILS</h3>
              <div style="display:grid;grid-template-columns:1fr;gap:6px;font-size:11px">
                <div><strong>Contract Amount:</strong> ${fmt(contractAmount)}</div>
                <div><strong>Cash/Check:</strong> ${fmt(parseNum(c.cashCheck))}</div>
                <div><strong>Finance Amount:</strong> ${fmt(parseNum(c.financeAmount))}</div>
                <div><strong>House Fee (${c.houseFeePercent || 0}%):</strong> ${fmt(houseFeeAmount)}</div>
                <div><strong>Dealer Fee (${c.dealerFee || 0}%):</strong> ${fmt(dealerFeeAmount)}</div>
                <div><strong>Credit Card (${c.creditCardFee || 0}%):</strong> ${fmt(creditCardFeeAmt)}</div>
                <div><strong>Labor & Material:</strong> ${fmt(parseNum(c.laborMaterial))}</div>
                <div><strong>Ride Along Fee:</strong> ${fmt(parseNum(c.rideAlong))}</div>
                <div style="background:#bfdbfe;padding:6px;border-radius:4px;text-align:center;margin-top:6px">
                  <strong>Total After Fees:</strong> ${fmt(totalAfterFees)}
                </div>
              </div>
            </div>
          `;

          if (d.vc > 0) {
            html += `
              <div style="background:#dcfce7;padding:18px;border-radius:10px;border:3px solid #16a34a;margin-bottom:18px">
                <h3 style="font-size:16px;font-weight:bold;margin-bottom:12px;border-bottom:2px solid #16a34a;padding-bottom:6px">VETS (${d.vc})</h3>
                <div style="text-align:center;background:white;padding:6px;border-radius:4px;margin-bottom:10px;font-size:11px"><strong>Profit Margin:</strong> ${d.pc ? d.pc.toFixed(1) : '0.0'}% ‚Üí <strong>Rate:</strong> ${d.vr}%</div>
                <div style="text-align:center;background:white;padding:8px;border-radius:6px;font-size:11px"><strong>Per Person:</strong> <span style="font-size:18px;font-weight:bold;color:#16a34a">${fmt(d.pv)}</span></div>
                <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-top:6px;font-size:11px"><strong>Total Vet Payout:</strong> <span style="font-size:16px;font-weight:bold;color:#16a34a">${fmt(d.pv * d.vc)}</span></div>
              </div>
            `;
          }

          if (d.rc > 0) {
            html += `
              <div style="background:#f3e8ff;padding:18px;border-radius:10px;border:3px solid #9333ea;margin-bottom:18px">
                <h3 style="font-size:16px;font-weight:bold;margin-bottom:12px;border-bottom:2px solid #9333ea;padding-bottom:6px">SALES REPS (${d.rc})</h3>
                <div style="text-align:center;background:white;padding:6px;border-radius:4px;margin-bottom:10px;font-size:11px"><strong>Profit Margin:</strong> ${d.pc ? d.pc.toFixed(1) : '0.0'}% ‚Üí <strong>Rate:</strong> ${d.rr}%</div>
                <div style="text-align:center;background:white;padding:8px;border-radius:6px;font-size:11px"><strong>Per Person:</strong> <span style="font-size:18px;font-weight:bold;color:#9333ea">${fmt(d.pr)}</span></div>
                <div style="text-align:center;background:white;padding:8px;border-radius:6px;margin-top:6px;font-size:11px"><strong>Total Rep Payout:</strong> <span style="font-size:16px;font-weight:bold;color:#9333ea">${fmt(d.pr * d.rc)}</span></div>
              </div>
            `;
          }

          if (d.rac > 0) {
            html += `
              <div style="background:#fef3c7;padding:18px;border-radius:10px;border:3px solid #eab308;margin-bottom:18px">
                <h3 style="font-size:16px;font-weight:bold;margin-bottom:12px;border-bottom:2px solid #eab308;padding-bottom:6px">RIDE ALONG (${d.rac})</h3>
                <div style="text-align:center;background:white;padding:6px;border-radius:4px;margin-bottom:10px;font-size:11px"><strong>Per Ride Along:</strong> ${fmt(d.pra)}</div>
            `;
            for (let j = 0; j < d.rac; j++) {
              const n = (c.rideAlongNames && c.rideAlongNames[j]) || `Ride Along ${j + 1}`;
              html += `
                <div style="background:white;padding:12px;border-radius:8px;border:2px solid #eab308;margin-bottom:8px;display:flex;justify-content:space-between;flex-wrap:wrap">
                  <div style="font-weight:bold;font-size:15px;margin-right:8px">${n}</div>
                  <div style="font-weight:bold;font-size:20px;color:#eab308">${fmt(d.pra)}</div>
                </div>
              `;
            }
            html += `
                <div style="text-align:center;background:white;padding:6px;border-radius:4px;margin-top:10px;font-size:11px">
                  <strong>Total:</strong> <span style="font-size:16px;font-weight:bold;color:#eab308">${fmt(d.tra)}</span>
                </div>
              </div>
            `;
          }

          html += `</div>`;
        });

        html += `
          <div style="text-align:center;padding:20px">
            <button class="print-btn" style="background:#2563eb;color:white;padding:12px 30px;border:none;border-radius:10px;font-weight:bold;font-size:16px;margin-right:10px;cursor:pointer">üñ®Ô∏è PRINT ALL</button>
            <button class="close-btn" style="background:#6b7280;color:white;padding:12px 30px;border:none;border-radius:10px;font-weight:bold;font-size:16px;cursor:pointer">CLOSE</button>
          </div>
        `;
        showPrint(html);
      };

      return (
        <div className="min-h-screen">
          <div id="mainView" ref={mainViewRef} className="p-4">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6 border-4 border-blue-500">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-blue-800">ALTA CAL PROFIT SHARE</h1>
                <button
                  onClick={printAllFiles}
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg flex items-center gap-2"
                >
                  <Printer size={24}/>PRINT ALL
                </button>
              </div>

              <div className="grid grid-cols-2 gap-6 max-w-4xl mx-auto">
                <div className="bg-gradient-to-br from-green-400 to-green-600 p-8 rounded-lg text-white">
                  <div className="text-sm font-bold mb-2">TOTAL VET PAYOUT</div>
                  <div className="text-4xl font-bold">{fmt(totals.v)}</div>
                </div>
                <div className="bg-gradient-to-br from-purple-400 to-purple-600 p-8 rounded-lg text-white">
                  <div className="text-sm font-bold mb-2">TOTAL REP PAYOUT</div>
                  <div className="text-4xl font-bold">{fmt(totals.r)}</div>
                </div>
              </div>
            </div>

            {calcs.map((c) => (
              <SingleCalculator
                key={c.id}
                data={c}
                onChange={(n) => setCalcs((arr) => arr.map(x => x.id === c.id ? n : x))}
                onRemove={() => setCalcs((arr) => arr.filter(x => x.id !== c.id))}
                canRemove={calcs.length > 1}
                onPrint={() => {
                  const idx = calcs.findIndex(x => x.id === c.id);
                  if (idx >= 0) printOne(idx);
                }}
              />
            ))}

            <div className="text-center mt-6">
              <button
                onClick={() => setCalcs((arr) => [...arr, blank()])}
                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-full shadow-lg flex items-center gap-3 mx-auto text-xl"
              >
                <Plus size={28}/>ADD NEW FILE
              </button>
            </div>
          </div>

          <div id="printView" ref={printViewRef} style={{ display: 'none' }}></div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
